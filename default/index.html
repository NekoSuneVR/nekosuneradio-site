<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NekoSune Community - Radio Station</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- 
       Twitter/X Emebd OG
   -->
   <meta name="twitter:card" content="player">
   <meta name="twitter:site" content="@nekosunevr">
   <meta name="twitter:player" content="https://widgets.nekosunevr.co.uk/radiochannels/index.html">
   <meta name="twitter:player:width" content="100">
   <meta name="twitter:player:height" content="160">
   <meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/CD-ROM.png/640px-CD-ROM.png">
   
   <!-- 
       Discord Emebd OG
   -->
   <meta property="og:title" content="NekoSune Community Radio - Playing Mixture songs powered by community">
   <meta property="og:description" content="We are playing this Private hosted Radio to for VRChat World Users listlen our Music and enjoy wonderful music we make or use. all music has they own copyright rights to creators of music and credits to them, we only using music as fair use for VRChat worlds to listlen up updates and many more.">
   <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/CD-ROM.png/640px-CD-ROM.png">
   <meta property="og:url" content="https://widgets.nekosunevr.co.uk/radiochannels/">
   <meta property="og:audio" content="https://icy.nekosunevr.co.uk/nekosunecommunity.mp3">
   <meta property="og:audio:type" content="audio/mp3">
   <meta property="og:audio:secure_url" content="https://icy.nekosunevr.co.uk/nekosunecommunity.mp3">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .disc { width: 16rem; height: 16rem; display: flex; align-items: center; justify-content: center; }
    .disc.playing { animation: spin 6s linear infinite; }
    .disc.paused { animation-play-state: paused; }
    @keyframes spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="max-w-4xl w-full grid grid-cols-1 md:grid-cols-3 gap-6">
    
    <!-- Player -->
    <div class="col-span-1 flex flex-col items-center gap-4">
      <div class="relative">
        <div id="disc" class="disc rounded-full shadow-2xl">
          <div class="w-full h-full rounded-full overflow-hidden border-4 border-gray-800">
            <img id="coverArt" src="https://placehold.co/400x400?text=No+Cover" alt="cover" class="w-full h-full object-cover" />
          </div>
        </div>
      </div>

      <div class="text-center">
        <h3 id="songTitle" class="text-lg font-semibold">Loading...</h3>
        <p id="songArtist" class="text-sm text-gray-400">Please wait</p>
        <p id="djStatus" class="text-xs text-gray-500 mt-1">AutoDJ</p>
      </div>

      <div class="flex items-center gap-3 mt-3">
        <button id="playBtn" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">Play</button>
        <input id="volume" type="range" min="0" max="1" step="0.01" value="0.5">
      </div>

      <audio id="player" src="https://icy.nekosunevr.co.uk/nekosunecommunity.mp3"></audio>
    </div>

    <!-- Info & Requests -->
    <div class="col-span-2 bg-gray-800/40 rounded-2xl p-4 shadow-lg flex flex-col gap-4">
      <h2 class="text-2xl font-bold">Your Station</h2>

      <div>
        <h4 class="font-semibold mb-2">On Air DJs</h4>
        <div id="djList" class="text-sm text-gray-400">Loading...</div>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Now Playing</h4>
        <div id="nowPlaying" class="text-sm text-gray-300">Fetching...</div>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Request a Song</h4>
        <details class="bg-gray-800 rounded-lg">
          <summary class="cursor-pointer px-4 py-2 font-semibold bg-gray-700 rounded-t-lg hover:bg-gray-600">
            Available Songs (click to expand)
          </summary>
          <div id="songs" class="p-4 grid gap-4 max-h-96 overflow-y-auto"></div>
        </details>
      </div>
    </div>
  </div>

  <script>
    const player = document.getElementById("player");
    const playBtn = document.getElementById("playBtn");
    const volume = document.getElementById("volume");
    const disc = document.getElementById("disc");
    
    function updateImageURL(songURL) {
        var ogImageTag = document.querySelector('meta[property="og:image"]');
        var twitterImageTag = document.querySelector('meta[name="twitter:image"]');
    
        ogImageTag.setAttribute('content', songURL);
        twitterImageTag.setAttribute('content', songURL);
    }

    playBtn.addEventListener("click", () => {
      if (player.paused) {
        player.play();
        disc.classList.add("playing");
        playBtn.textContent = "Pause";
      } else {
        player.pause();
        disc.classList.remove("playing");
        playBtn.textContent = "Play";
      }
    });

    volume.addEventListener("input", e => { player.volume = e.target.value; });

    async function fetchData() {
      try {
        const res = await fetch("api.php?action=nowplaying");
        const data = await res.json();

        document.getElementById("songTitle").textContent = data.title || "Unknown";
        document.getElementById("songArtist").textContent = data.artist || "Unknown";
        document.getElementById("coverArt").src = data.art || "https://placehold.co/400x400?text=No+Cover";
        document.getElementById("djStatus").textContent = data.is_live ? "Live DJ" : "AutoDJ";
        document.getElementById("nowPlaying").textContent = `${data.title} - ${data.artist}`;
        document.getElementById("djList").textContent = data.djs.length ? data.djs.join(", ") : "No DJs live right now.";
        document.title = `NekoSune Community Radio: ${data.artist} - ${data.title}`;
        updateImageURL(data.art);
      } catch (e) {
        console.error(e);
      }
    }

    // Poll every 10 seconds
    setInterval(fetchData, 3000);
    fetchData();

    async function loadSongs() {
      const res = await fetch("api.php?action=list");
      const songs = await res.json();
      const container = document.getElementById("songs");
      container.innerHTML = "";
      songs.forEach(song => {
        container.innerHTML += `
          <div class="flex items-center gap-4 bg-gray-900 p-3 rounded-lg">
            <img src="${song.song.art}" class="w-16 h-16 rounded-full animate-spin-slow" alt="cover">
            <div class="flex-1">
              <div class="font-bold">${song.song.title}</div>
              <div class="text-sm text-gray-400">${song.song.artist}</div>
            </div>
            <button onclick="requestSong('${song.request_id}')" class="bg-blue-600 px-3 py-1 rounded hover:bg-blue-500">
              Request
            </button>
          </div>`;
      });
    }

    async function requestSong(id) {
      const res = await fetch("api.php?action=request", {
        method: "POST",
        body: new URLSearchParams({ request_id: id })
      });
      const data = await res.json();
      alert(data.message || "Request sent!");
    }

    loadSongs();
  </script>
</body>
</html>
